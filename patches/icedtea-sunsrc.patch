--- openjdk.orig/jdk/make/common/Release.gmk	2008-02-28 04:39:40.000000000 -0500
+++ openjdk/jdk/make/common/Release.gmk	2008-02-29 14:34:26.000000000 -0500
@@ -338,8 +338,6 @@
 # Bug 5008685 - exclude jconsole from sun/tools
 #
 TOOLS = \
-	META-INF/services/com.sun.jdi.connect.Connector \
-	META-INF/services/com.sun.jdi.connect.spi.TransportService \
 	sun/tools/asm		\
 	sun/tools/jar		\
 	sun/tools/java		\
@@ -381,8 +379,6 @@
 	com/sun/tools/corba     \
 	com/sun/tools/internal/xjc       \
 	com/sun/tools/internal/ws       \
-	META-INF/services/com.sun.mirror.apt.AnnotationProcessorFactory \
-	META-INF/services/com.sun.tools.internal.xjc.Plugin \
 	com/sun/istack/internal/tools       \
 	com/sun/istack/internal/ws       \
         com/sun/codemodel       \
@@ -393,7 +389,6 @@
 	com/sun/xml/internal/dtdparser \
 	com/sun/tools/jdi	\
 	com/sun/tools/script/shell	\
-	META-INF/services/com.sun.tools.attach.spi.AttachProvider \
 	com/sun/tools/attach	\
 	sun/tools/attach	\
 	sun/tools/jstack        \
@@ -557,10 +552,6 @@
 	$(ECHO) "com/sun/source/" >> $@
 	$(ECHO) "com/sun/istack/internal/tools/" >> $@
 	$(ECHO) "com/sun/istack/internal/ws/" >> $@
-	$(ECHO) "META-INF/services/com.sun.jdi.connect.Connector" >> $@
-	$(ECHO) "META-INF/services/com.sun.jdi.connect.spi.TransportService" >> $@
-	$(ECHO) "META-INF/services/com.sun.mirror.apt.AnnotationProcessorFactory" >> $@
-	$(ECHO) "META-INF/services/com.sun.tools.internal.xjc.Plugin" >> $@
 	$(ECHO) "com/sun/tools/" >> $@
 	$(ECHO) "sun/jvmstat/" >> $@
 	$(ECHO) "sun/rmi/rmic/" >> $@
@@ -592,7 +583,6 @@
 	$(ECHO) "javax/crypto/" >> $@
 	$(ECHO) "sun/security/internal/" >> $@
 	$(ECHO) "com/sun/crypto/provider/" >> $@
-	$(ECHO) "META-INF/services/com.sun.tools.attach.spi.AttachProvider" >> $@
 	$(ECHO) "com/sun/tools/attach/" >> $@
 	$(ECHO) "org/relaxng/datatype/" >> $@
 	$(ECHO) "com/sun/codemodel/" >> $@
@@ -626,6 +616,10 @@
 	    $(BOOT_JAVA_CMD) -jar $(JARREORDER_JARFILE) \
 		-o  $@.temp $(ABS_LIBDIR)/classlist $(NOT_RT_JAR_LIST) . )
 	$(MV) $@.temp $@
+	$(CAT) $@ | $(GREP) "^sun" | $(GREP) "class" | $(GREP) -v '\$$' \
+	  > $(ABS_TEMPDIR)/sun_classes_list
+	sed 's/\.class/\.java/' < $(ABS_TEMPDIR)/sun_classes_list \
+	  > $(ABS_TEMPDIR)/sun_sources_list
 	@($(CD) $(CLASSBINDIR) && $(java-vm-cleanup))
 
 # Create the rt.jar file list & non-class files list
@@ -1006,6 +1000,8 @@
 	    ($(CD) $$d && $(TAR) cf - -T $(ABS_TEMPDIR)/src-files.list ) \
 	       | ($(CD) $(JDK_IMAGE_DIR)/src && $(TAR) xf -); \
 	  fi; \
+	  (($(CD) $$d && $(TAR) cf - -T $(ABS_TEMPDIR)/sun_sources_list ) \
+		| ($(CD) $(JDK_IMAGE_DIR)/src && $(TAR) xf -)) > /dev/null 2>&1 ; \
 	done
   else
 	for d in $(SOURCE_DIRS); do \
